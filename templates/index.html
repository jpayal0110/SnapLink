<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapLink - URL Shortener</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="cartoon-bg" id="cartoonBg"></div>
    <div class="particles" id="particles"></div>
    <div class="container">
        <div class="header">
            <h1 class="site-title">SnapLink</h1>
            <p class="site-description">Transform long URLs into short, shareable links instantly</p>
        </div>
        
        <div class="main-content">
            <form method="POST" class="url-form">
                <div class="input-group">
                    <input 
                        type="url" 
                        name="original_url" 
                        placeholder="Paste your long URL here..." 
                        required
                        class="url-input"
                    >
                </div>
                <div class="button-group">
                    <button type="submit" class="shorten-btn">Shorten URL</button>
                </div>
            </form>
            
            {% if short_url %}
            <div class="result-section">
                <h3>Your shortened URL:</h3>
                <div class="short-url-display">
                    <input type="text" value="{{ short_url }}" readonly class="short-url-input">
                    <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
                </div>

                <div class="qr-section">
                    <h4>Scan the QR code:</h4>
                    <div id="qrcode"></div>
                    <div class="qr-actions">
                        <button class="copy-btn" onclick="downloadQR()"><i class="fa-solid fa-download"></i> Download QR</button>
                    </div>
                </div>

                <a href="/" class="shorten-another">Shorten another URL</a>
            </div>
            {% endif %}
        </div>
        
        <div class="footer">
            <!-- Stats functionality will be added later with user profiles -->
        </div>
    </div>

    <script>
        function copyToClipboard() {
            const shortUrlInput = document.querySelector('.short-url-input');
            if (!shortUrlInput) return;
            shortUrlInput.select();
            shortUrlInput.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            const copyBtn = document.querySelector('.copy-btn');
            if (!copyBtn) return;
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'Copied!';
            copyBtn.classList.add('copied');
            
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.classList.remove('copied');
            }, 2000);
        }

        // Generate QR if a short URL is present
        function renderQRCode() {
            const shortUrlInput = document.querySelector('.short-url-input');
            const qrContainer = document.getElementById('qrcode');
            if (!shortUrlInput || !qrContainer) return;
            const url = shortUrlInput.value;
            if (!url) return;
            qrContainer.innerHTML = '';
            new QRCode(qrContainer, {
                text: url,
                width: 200,
                height: 200,
                colorDark: '#1e293b',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // Download QR image
        function downloadQR() {
            const qrContainer = document.getElementById('qrcode');
            if (!qrContainer) return;
            const canvas = qrContainer.querySelector('canvas');
            const img = qrContainer.querySelector('img');
            let dataUrl = '';
            if (canvas) {
                dataUrl = canvas.toDataURL('image/png');
            } else if (img) {
                dataUrl = img.src;
            } else {
                return;
            }
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = 'snaplink-qr.png';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;
            const particleCount = 15;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Cartoons
        function createCartoons() {
            const cartoonBg = document.getElementById('cartoonBg');
            if (!cartoonBg) return;
            const cartoonTypes = [
                { icon: 'fas fa-link', class: 'link-icon', animation: 'floatLeft' },
                { icon: 'fas fa-globe', class: 'globe-icon', animation: 'floatRight' },
                { icon: 'fas fa-rocket', class: 'rocket-icon', animation: 'floatLeft' },
                { icon: 'fas fa-star', class: 'star-icon', animation: 'bounce' },
                { icon: 'fas fa-paper-plane', class: 'link-icon', animation: 'floatRight' },
                { icon: 'fas fa-share-nodes', class: 'chain-icon', animation: 'floatLeft' },
                { icon: 'fas fa-bolt', class: 'globe-icon', animation: 'bounce' },
                { icon: 'fas fa-gem', class: 'link-icon', animation: 'floatRight' }
            ];
            cartoonTypes.forEach((cartoon) => {
                const element = document.createElement('div');
                element.className = `cartoon-element ${cartoon.class}`;
                element.innerHTML = `<i class="${cartoon.icon}"></i>`;
                element.style.left = Math.random() * 100 + '%';
                element.style.top = Math.random() * 100 + '%';
                element.style.animationDelay = Math.random() * 5 + 's';
                element.style.animationDuration = (Math.random() * 3 + 4) + 's';
                element.style.animationName = cartoon.animation;
                element.style.animationIterationCount = 'infinite';
                element.style.animationTimingFunction = 'ease-in-out';
                const size = Math.random() * 0.5 + 0.8;
                element.style.transform = `scale(${size})`;
                cartoonBg.appendChild(element);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            createCartoons();
            renderQRCode();
        });
    </script>
</body>
</html>
